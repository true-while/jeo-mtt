@model IEnumerable<JeoMTT.Models.JeoGame>

@{
    ViewData["Title"] = "Jeopardy Games";
}

<div class="container-fluid mt-4" style="background-color: #F6F7FB; min-height: 100vh; padding: 20px 0;">
    <div class="container">
        <div class="row mb-4">
            <div class="col-md-8">
                <h1>@ViewData["Title"]</h1>
                <p class="text-muted">Manage your Jeopardy games here</p>
            </div>
            <div class="col-md-4 text-end">
                <a asp-action="CreateGame" class="btn btn-primary btn-lg">
                    <i class="bi bi-plus-circle"></i> Create New Game
                </a>
            </div>
        </div>

        @if (Model.Any())
        {
            <div class="mb-4">
                <p class="text-muted">Total Games: <strong>@Model.Count()</strong></p>
            </div>

            <div class="row g-4">
                @foreach (var item in Model)
                {
                    var categoryCount = item.Categories?.Count ?? 0;
                    var questionCount = item.Categories?.Sum(c => c.Questions?.Count ?? 0) ?? 0;

                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100" style="border: 1px solid #E4E7F2; background-color: #FFFFFF; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                            <div class="card-body">
                                <h5 class="card-title" style="color: #4650E3; margin-bottom: 15px;">
                                    @item.Name
                                </h5>
                                
                                @if (!string.IsNullOrEmpty(item.Description))
                                {
                                    <p class="card-text text-muted" style="font-size: 0.95rem; margin-bottom: 15px;">
                                        @{
                                            var description = item.Description;
                                            if (description.Length > 80)
                                            {
                                                @Html.Raw(System.Net.WebUtility.HtmlEncode(description.Substring(0, 80)) + "...")
                                            }
                                            else
                                            {
                                                @Html.Raw(System.Net.WebUtility.HtmlEncode(description))
                                            }
                                        }
                                    </p>
                                }

                                <div style="border-top: 1px solid #E4E7F2; padding-top: 12px; margin-bottom: 15px;">
                                    <div class="row">
                                        <div class="col-6">
                                            <small class="text-muted d-block">Groups</small>
                                            <strong style="color: #4650E3; font-size: 1.25rem;">@categoryCount</strong>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted d-block">Questions</small>
                                            <strong style="color: #4650E3; font-size: 1.25rem;">@questionCount</strong>
                                        </div>
                                    </div>
                                </div>

                                <small class="text-muted d-block mb-3">
                                    Created: @item.CreatedAt.ToString("MMM dd, yyyy")
                                </small>
                            </div>

                            <div class="card-footer" style="background-color: #F6F7FB; border-top: 1px solid #E4E7F2;">
                                <div class="d-grid gap-2">
                                    <a asp-action="EditGame" asp-route-id="@item.Id" class="btn btn-primary btn-sm">
                                        <i class="bi bi-pencil"></i> Edit
                                    </a>
                                    <a asp-action="DeleteGame" asp-route-id="@item.Id" class="btn btn-outline-danger btn-sm">
                                        <i class="bi bi-trash"></i> Delete
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        }
        else
        {
            <div class="alert alert-info alert-dismissible fade show" role="alert" style="background-color: #E3F2FD; border-color: #90CAF9; color: #1565C0;">
                <strong>No games yet!</strong> Start by creating your first Jeopardy game.
                <a asp-action="CreateGame" class="alert-link">Create Now</a>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }
    </div>
</div>


<style>
    /* Page-specific background color */
    body {
        background-color: #F6F7FB;
    }
</style>

@section Scripts {
    <script>
        // Track page load performance
        const indexPageStart = performance.now();
        
        window.addEventListener('load', function() {
            const loadTime = performance.now() - indexPageStart;
            if (window.trackEvent) {
                trackEvent('JeoGameIndex_PageLoadComplete', {
                    'loadTimeMs': loadTime.toFixed(2),
                    'gameCount': '@Model.Count()'
                });
            }
        });

        // Track game interactions
        document.querySelectorAll('[class*="btn-outline"]').forEach(button => {
            button.addEventListener('click', function(e) {
                const actionText = this.title || this.innerText.trim();
                const href = this.getAttribute('href');
                const gameId = href ? href.match(/\d+/)?.[0] : 'unknown';
                
                if (window.trackEvent) {
                    trackEvent('JeoGameAction', {
                        'action': actionText,
                        'gameId': gameId
                    });
                }
            });
        });

        // Track Create button clicks
        document.querySelectorAll('[class*="btn-primary"]').forEach(button => {
            if (button.textContent.includes('Create')) {
                button.addEventListener('click', function() {
                    if (window.trackEvent) {
                        trackEvent('JeoGameCreateClicked', {
                            'source': 'index_page'
                        });
                    }
                });
            }
        });
    </script>
}
